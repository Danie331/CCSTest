<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="js/MessageBroker.js"></script>
    <script src="js/EmployeeService.js"></script>
</head>
<body>    
    <script>
        var employee1 = null, employee2 = null;
        $(function () {
            var app = app || {};
            app.eventBroker = new MessageBroker();
            app.service = new EmployeeService(app.eventBroker);

            // Join or chain ajax functions syncronously to test.

            // Wire up callback functions
            app.eventBroker.subscribe(onEmployeesRetrieved, EventMessageType.EMPLOYEES_RETRIEVED);
            app.eventBroker.subscribe(onEmployeeRetrieved, EventMessageType.EMPLOYEE_RETRIEVED);
            app.eventBroker.subscribe(onEmployeeUpdated, EventMessageType.EMPLOYEE_UPDATED);
            app.eventBroker.subscribe(onEmployeeDeleted, EventMessageType.EMPLOYEE_DELETED);

            // Add 2 employees
            employee1 = { LastName: 'vd merwe', FirstName: 'danie', BirthDate: '1985-01-27', EmployeeNum: '123', EmployedDate: '2020-08-12' };
            employee2 = { LastName: 'smith', FirstName: 'john', BirthDate: '1986-08-25', EmployeeNum: '456', EmployedDate: '2010-02-15' };
            app.eventBroker.broadcast(EventMessageType.ADD_EMPLOYEE, employee1);
            app.eventBroker.broadcast(EventMessageType.ADD_EMPLOYEE, employee2);

            // Retrieve all employees
            app.eventBroker.broadcast(EventMessageType.GET_EMPLOYEES);

            // Update employee1 --> set employee number to 'XYZ'
            employee1.EmployeeId = 1; // would normally be saved back to the data row after ajax call.
            employee1.EmployeeNum = 'XYZ';
            app.eventBroker.broadcast(EventMessageType.UPDATE_EMPLOYEE, employee1, employee1.EmployeeId);

            //// Delete employee2 
            app.eventBroker.broadcast(EventMessageType.DELETE_EMPLOYEE, 2);
        });

        function onEmployeesRetrieved(data) {
            $.each(data, function (index, value) {
                console.log(`EmployeeId: ${value.EmployeeId} | First Name: ${value.FirstName} | Last Name: ${value.LastName} | Birth Date: ${value.BirthDate} | EmployeeNum: ${value.EmployeeNum} | EmployedDate: ${value.EmployedDate}`);
            });
        }

        function onEmployeeRetrieved(data) {
            $.each(data, function (index, value) {
                console.log(`EmployeeId: ${value.EmployeeId} | First Name: ${value.FirstName} | Last Name: ${value.LastName} | Birth Date: ${value.BirthDate} | EmployeeNum: ${value.EmployeeNum} | EmployedDate: ${value.EmployedDate}`);
            });
        }

        function onEmployeeUpdated(data) {
            console.log(`Updated: EmployeeId: ${value.EmployeeId} | First Name: ${value.FirstName} | Last Name: ${value.LastName} | Birth Date: ${value.BirthDate} | EmployeeNum: ${value.EmployeeNum} | EmployedDate: ${value.EmployedDate}`);
        }

        function onEmployeeDeleted(data) {
            console.log(`Deleted: EmployeeId: ${value.EmployeeId} | First Name: ${value.FirstName} | Last Name: ${value.LastName} | Birth Date: ${value.BirthDate} | EmployeeNum: ${value.EmployeeNum} | EmployedDate: ${value.EmployedDate}`);
        }
    </script>
</body>
</html>